# API Worker wrangler.toml for StoryChat
# This file extends the root configuration for the specific API worker

name = "storychat-api"
main = "src/index.ts"
compatibility_date = "2024-02-08"
compatibility_flags = ["nodejs_compat"]

[vars]
APP_NAME = "StoryChat API"
APP_VERSION = "1.0.0"
ENVIRONMENT = "development"

# D1 Database binding - inherited from root config
[[d1_databases]]
binding = "DB"
database_name = "storychat-db"
database_id = ""
migrations_dir = "../../infra/d1/migrations"

# KV Namespace for sessions, settings, rate limits
[[kv_namespaces]]
binding = "STORYCHAT_CACHE"
id = ""

# R2 Bucket for story images, user avatars
[[r2_buckets]]
binding = "STORYCHAT_MEDIA"
bucket_name = "storychat-media"

# Environment overrides
[env.staging]
name = "storychat-api-staging"

[env.staging.vars]
ENVIRONMENT = "staging"

[env.production]
name = "storychat-api-production"

[env.production.vars]
ENVIRONMENT = "production"

[build]
command = "pnpm build"
minify = true