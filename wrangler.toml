# Root wrangler.toml for StoryChat
# Shared configuration for all Workers
name = "storychat"
main = "apps/api/src/index.ts"
compatibility_date = "2024-02-08"
compatibility_flags = ["nodejs_compat"]

# Top-level environment variables (not secrets)
[vars]
APP_NAME = "StoryChat"
APP_VERSION = "1.0.0"
ENVIRONMENT = "development"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "storychat-db"
database_id = ""
migrations_dir = "infra/d1/migrations"

# KV Namespace for caching (create via: wrangler kv:namespace create "STORYCHAT_CACHE")
[[kv_namespaces]]
binding = "STORYCHAT_CACHE"
id = ""

# R2 Bucket for media storage (create via: wrangler r2 bucket create storychat-media)
[[r2_buckets]]
binding = "STORYCHAT_MEDIA"
bucket_name = "storychat-media"

# Environment-specific overrides
[env.staging]
name = "storychat-staging"

[env.staging.vars]
ENVIRONMENT = "staging"

[env.production]
name = "storychat-production"

[env.production.vars]
ENVIRONMENT = "production"

# Build configuration
[build]
command = "pnpm build:api"
minify = true
