# Root wrangler.toml for StoryChat
# Shared configuration for all Workers
name = "storychat"
main = "apps/api/src/index.ts"
compatibility_date = "2024-02-08"
compatibility_flags = ["nodejs_compat"]

# Top-level environment variables (not secrets)
[vars]
APP_NAME = "StoryChat"
APP_VERSION = "1.0.0"
ENVIRONMENT = "development"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "storychat-db"
database_id = "a17edd41-6a29-4d48-adb4-fe4e607e4963"
migrations_dir = "infra/d1/migrations"

# KV Namespaces
[[kv_namespaces]]
binding = "SESSIONS"
id = "2c0ef1885e234658b13b87cea3474a36"

[[kv_namespaces]]
binding = "RATELIMIT"
id = "c3c5ac1c6c5b4f69918912a4ac43a246"

# R2 Bucket for media storage (create via: wrangler r2 bucket create storychat-media)
[[r2_buckets]]
binding = "STORYCHAT_MEDIA"
bucket_name = "storychat-media"

# Environment-specific overrides
[env.staging]
name = "storychat-staging"

[env.staging.vars]
ENVIRONMENT = "staging"

[env.production]
name = "storychat-production"

[env.production.vars]
ENVIRONMENT = "production"

# Build configuration
[build]
command = "pnpm build:api"
minify = true
